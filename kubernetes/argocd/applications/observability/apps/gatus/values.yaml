---
# Helm values for gatus deployment
controllers:
  gatus:
    annotations:
      reloader.stakater.com/auto: "true"
      # Exclude from Goldilocks VPA Auto mode - using custom VPA with Off mode instead
      goldilocks.fairwinds.com/vpa-update-mode: "off"
    serviceAccount:
      identifier: gatus
    containers:
      app:
        image:
          repository: ghcr.io/twin/gatus
          tag: v5.33.1@sha256:7121b5916c069eac6e266875d4984ec9262d84bd1274963939b358b32476d25b
        env:
          TZ: Europe/Helsinki
          GATUS_CONFIG_PATH: /config
          GATUS_DELAY_START_SECONDS: 5
          WEB_PORT: &port 8080
        probes:
          liveness: &probes
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /health
                port: *port
              initialDelaySeconds: 30
              periodSeconds: 10
              timeoutSeconds: 5
              failureThreshold: 5
          readiness: *probes
          startup:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /health
                port: *port
              initialDelaySeconds: 10
              periodSeconds: 5
              timeoutSeconds: 5
              failureThreshold: 60
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities: { drop: ["ALL"] }
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            memory: 1024Mi
            # No CPU limit - Gatus needs to burst during health check cycles (40+ endpoints)
      gatus-sidecar:
        image:
          repository: ghcr.io/home-operations/gatus-sidecar
          tag: latest
        args:
          - --enable-httproute
          - --auto-httproute
          - --enable-ingress=false
          - --auto-ingress=false
          - --output=/config/gatus-sidecar.yaml
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 256Mi
defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch
service:
  app:
    controller: gatus
    ports:
      http:
        port: 80
        targetPort: *port
serviceMonitor:
  app:
    serviceName: gatus
    endpoints:
      - port: http
serviceAccount:
  gatus: {}
persistence:
  config:
    existingClaim: gatus
  config-file:
    type: configMap
    name: gatus-config
    globalMounts:
      - path: /config/config.yaml
        subPath: config.yaml
        readOnly: true
