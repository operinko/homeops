---
# Helm values for elasticsearch deployment
# Single-node Elasticsearch cluster for Falco events

# Use Elasticsearch 7.x (allows disabling security completely)
imageTag: "7.17.27"

# Cluster configuration
clusterName: "elasticsearch"
nodeGroup: "master"

# Single-node cluster (simpler, more reliable for homelab)
replicas: 1
minimumMasterNodes: 1

# Resources (1 CPU core for acceptable performance)
resources:
  requests:
    cpu: "1000m"
    memory: "2Gi"
  limits:
    cpu: "2000m"
    memory: "4Gi"

# JVM heap size (50% of memory limit)
esJavaOpts: "-Xmx2g -Xms2g"

# Persistence
persistence:
  enabled: true
  labels:
    app.kubernetes.io/name: elasticsearch
  annotations:
    argocd.argoproj.io/sync-wave: "0"

volumeClaimTemplate:
  accessModes: ["ReadWriteOnce"]
  storageClassName: "ceph-rbd"
  resources:
    requests:
      storage: 32Gi

# Security - use auto-generated certificates and passwords
# The Helm chart automatically creates self-signed certificates and sets
# ELASTIC_PASSWORD environment variable. We'll use this for Falcosidekick.
protocol: https

# Service
service:
  type: ClusterIP
  httpPort: 9200
  transportPort: 9300
  labels:
    app.kubernetes.io/name: elasticsearch
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9200"
    prometheus.io/path: "/_prometheus/metrics"

# Probes - give Elasticsearch time to start
readinessProbe:
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

livenessProbe:
  initialDelaySeconds: 90
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# No anti-affinity needed for single node
antiAffinity: "soft"

# Sysctls for Elasticsearch
sysctlInitContainer:
  enabled: true

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000

# Note: ILM policy and index template for Falco events will be created manually
# after Elasticsearch is running to avoid blocking pod startup with postStart hooks

