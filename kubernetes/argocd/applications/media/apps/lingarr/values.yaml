---
# Helm values for lingarr app-template deployment
controllers:
  lingarr:
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      app:
        image:
          repository: lingarr/lingarr
          tag: latest
        env:
          TZ: Europe/Helsinki
          ASPNETCORE_URLS: http://+:9876
          DB_CONNECTION: mysql
          DB_HOST: postgres17.database.svc.cluster.local
          DB_PORT: "5432"
          DB_DATABASE: lingarr
        envFrom:
          - secretRef:
              name: lingarr-db-secret
        probes:
          liveness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /
                port: &port 9876
              initialDelaySeconds: 30
              periodSeconds: 10
              timeoutSeconds: 10
              failureThreshold: 3
          readiness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /
                port: *port
              initialDelaySeconds: 15
              periodSeconds: 10
              timeoutSeconds: 10
              failureThreshold: 3
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities: { drop: ["ALL"] }
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            memory: 1Gi
defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 568
    runAsGroup: 568
    fsGroup: 568
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }
service:
  app:
    controller: lingarr
    ports:
      http:
        port: *port
persistence:
  config:
    existingClaim: lingarr
    globalMounts:
      - path: /app/config
  media:
    type: nfs
    server: 192.168.0.221
    path: /mnt/Nakkiallas/Media
    globalMounts:
      - path: /media
  tmp:
    type: emptyDir

