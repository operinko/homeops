---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: lingarr-db-secret
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: bitwarden-login
    kind: ClusterSecretStore
  target:
    name: lingarr-db-secret
    template:
      engineVersion: v2
      data:
        # Lingarr application database connection
        DB_USERNAME: "{{ .lingarr_username }}"
        DB_PASSWORD: "{{ .lingarr_password }}"
        # Init container variables (postgres-init pattern)
        INIT_POSTGRES_DBNAME: lingarr
        INIT_POSTGRES_HOST: postgres17.database.svc.cluster.local
        INIT_POSTGRES_USER: "{{ .lingarr_username }}"
        INIT_POSTGRES_PASS: "{{ .lingarr_password }}"
        INIT_POSTGRES_SUPER_PASS: "{{ .postgres_password }}"
  data:
    - secretKey: lingarr_username
      remoteRef:
        key: 972c365c-bc2a-402f-908f-6d42e9db4e12
        property: username
    - secretKey: lingarr_password
      remoteRef:
        key: 972c365c-bc2a-402f-908f-6d42e9db4e12
        property: password
    - secretKey: postgres_password
      remoteRef:
        key: c1b5bc1c-2635-4be4-9bfa-ad755db3daa
        property: password

