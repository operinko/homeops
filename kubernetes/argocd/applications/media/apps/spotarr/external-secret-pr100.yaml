---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: spotarr-secret
  namespace: media
spec:
  refreshInterval: 1h
  target:
    name: spotarr-secret
    creationPolicy: Owner
    deletionPolicy: Retain
  data:
    # Usenet credentials
    - secretKey: USENET__USERNAME
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: 15b18bb7-868d-4a6b-9ddf-43261a93a326
        property: username
    - secretKey: USENET__PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: 15b18bb7-868d-4a6b-9ddf-43261a93a326
        property: password
    - secretKey: USENET__HOSTNAME
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 15b18bb7-868d-4a6b-9ddf-43261a93a326
        property: hostname
    # PostgreSQL credentials (same as other *arr apps)
    - secretKey: POSTGRES_USER
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 0e9e9d3f-e4e8-4c8a-b8f8-c58c03f5246f
        property: username
    - secretKey: POSTGRES_PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 0e9e9d3f-e4e8-4c8a-b8f8-c58c03f5246f
        property: password
    - secretKey: DATABASE__CONNECTIONSTRING
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 0e9e9d3f-e4e8-4c8a-b8f8-c58c03f5246f
        property: spotarr_connection_string
    # Init container credentials
    - secretKey: INIT_POSTGRES_HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 0e9e9d3f-e4e8-4c8a-b8f8-c58c03f5246f
        property: host
    - secretKey: INIT_POSTGRES_SUPER_USER
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 0e9e9d3f-e4e8-4c8a-b8f8-c58c03f5246f
        property: superuser
    - secretKey: INIT_POSTGRES_SUPER_PASS
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 0e9e9d3f-e4e8-4c8a-b8f8-c58c03f5246f
        property: superuser_password

