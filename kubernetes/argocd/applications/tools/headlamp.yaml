---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: headlamp
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: tools
  sources:
    # Helm chart for application deployment
    - repoURL: https://kubernetes-sigs.github.io/headlamp/
      targetRevision: 0.37.0
      chart: headlamp
      helm:
        values: |
          config:
            pluginsDir: /build/plugins
          fullnameOverride: headlamp
          serviceAccount:
            create: false
            name: headlamp-admin
          persistentVolumeClaim:
            existingClaim: headlamp
          podAnnotations:
            reloader.stakater.com/auto: "true"
          volumeMounts:
            - mountPath: /build/plugins
              name: headlamp-plugins
          volumes:
            - name: headlamp-plugins
              persistentVolumeClaim:
                claimName: headlamp
    # Additional resources from git (HTTPRoute, RBAC, VolSync)
    - repoURL: https://github.com/operinko/homeops.git
      targetRevision: main
      path: kubernetes/apps/tools/headlamp/app
      directory:
        include: '{httproute.yaml,rbac.yaml,volsync.yaml}'
  destination:
    server: https://kubernetes.default.svc
    namespace: tools
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true

