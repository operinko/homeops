---
# Helm values for technitium deployment
controllers:
  technitium:
    strategy: Recreate
    initContainers:
      mk-pfx:
        image:
          repository: alpine/openssl
          tag: "3.5.4"
          pullPolicy: IfNotPresent
        command:
          - sh
          - -c
          - >-
            openssl pkcs12 -export -out /etc/dns/ssl.pfx -inkey /certs/tls.key -in /certs/tls.crt -passout pass:
    containers:
      app:
        image:
          repository: technitium/dns-server
          tag: 14.1.0
        envFrom:
          - secretRef:
              name: technitium-secret
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: false
          capabilities: { drop: ["ALL"] }
        resources:
          requests:
            cpu: 200m
            memory: 800Mi
          limits:
            cpu: 1000m
            memory: 2000Mi
defaultPodOptions:
  automountServiceAccountToken: false
  enableServiceLinks: false
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    fsGroupChangePolicy: "OnRootMismatch"
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
service:
  technitium:
    controller: technitium
    ports:
      http:
        port: 5380
  dns:
    controller: technitium
    type: LoadBalancer
    annotations:
      lbipam.cilium.io/ips: "192.168.7.7"
    ports:
      dns-tcp:
        enabled: true
        port: 53
        protocol: TCP
      dns-udp:
        enabled: true
        port: 53
        protocol: UDP
      dns-dot:
        enabled: true
        port: 853
        protocol: TCP
      dns-doh-http:
        enabled: true
        port: 80
        protocol: TCP
      dns-doh:
        enabled: true
        port: 443
        protocol: TCP
persistence:
  config:
    existingClaim: technitium
    globalMounts:
      - path: /etc/dns
  tls-secret:
    type: secret
    name: vaderrp-com-production-tls
    globalMounts:
      - path: /certs
        readOnly: true
