---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: ceph-csi-cephfs
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "2"
spec:
  project: storage
  source:
    repoURL: https://ceph.github.io/csi-charts
    chart: ceph-csi-cephfs
    targetRevision: 3.15.0
    helm:
      values: |
        csiConfig:
          - clusterID: "f8a1fd11-d230-4613-94ba-60ee9c610175"
            monitors:
              - "192.168.3.90:6789"
              - "192.168.3.91:6789"
        
        # Use unique configmap names to avoid collision with RBD release
        configMapName: cephfs-ceph-csi-config
        cephConfConfigMapName: cephfs-ceph-config
        kmsConfigMapName: cephfs-ceph-csi-encryption-kms-config
        nodeplugin:
          tolerateAllTaints: true
          httpMetrics:
            enabled: false
        storageClass:
          create: false
  destination:
    server: https://kubernetes.default.svc
    namespace: storage
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
      - ServerSideApply=true

