---
# SecretStore for pushing to Bitwarden via webhook
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: bitwarden-push
  namespace: bitwarden-external-secrets
spec:
  provider:
    webhook:
      #url: "http://bitwarden-eso-provider.bitwarden-external-secrets.svc.cluster.local:8087/object/item/{{ .remoteRef.remoteKey }}"
      url: "http://echo.default.svc.cluster.local:80/object/item/{{ .remoteRef.remoteKey }}"
      method: PUT
      headers:
        Content-Type: application/json
      secrets:
        - name: bw
          secretRef:
            namespace: bitwarden-external-secrets
            name: bw-push-data
      # Body template - test parsing JSON data
      body: |
        {{- $data := index .remoteRef .remoteRef.remoteKey | fromJson -}}
        DEBUG: username={{ $data.username }} password={{ $data.password }} name={{ $data.name }}

