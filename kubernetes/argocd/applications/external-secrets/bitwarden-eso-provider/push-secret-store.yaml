---
# SecretStore for pushing to Bitwarden via webhook
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: bitwarden-push
  namespace: bitwarden-external-secrets
spec:
  provider:
    webhook:
      url: "http://bitwarden-eso-provider.bitwarden-external-secrets.svc.cluster.local:8087/object/item/{{ .remoteRef.remoteKey }}"
      method: PUT
      headers:
        Content-Type: application/json
      secrets:
        - name: bw
          secretRef:
            namespace: bitwarden-external-secrets
            name: bw-push-data
      # Body template - the secret data will be available in the template context # folderId: "94fa1633-a293-4e43-9557-b8b6da7cfe66", notes: "Pushed from Kubernetes via PushSecret. Do not modify.",
      body: |
        '{
          "id": "{{ .remoteRef.remoteKey }}",
          "type": 1,
          "name": "{{ .remoteRef.name }}",
          "folderId": "{{ .bw.folderId }}",
          "notes": "{{ .bw.note }}",
          "login": {
            "username": "{{ .remoteRef.username }}",
            "password": "{{ .remoteRef.password }}"
          }
        }'

