---
# Helm values for falcosidekick deployment
# Event routing hub for Falco

# Replicas
replicaCount: 2

# Resources
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    memory: 256Mi

# Configuration
config:
  # Debug mode
  debug: false

  # Elasticsearch output (HTTPS with basic auth)
  # Credentials loaded from ExternalSecret via envFrom
  elasticsearch:
    hostport: "https://elasticsearch-es-http.observability.svc.cluster.local:9200"
    index: "falco"
    type: "_doc"
    minimumpriority: "debug"
    mutualtls: false
    checkcert: false  # Self-signed certificate

  # Discord output (will be configured via secret)
  discord:
    webhookurl: ""
    minimumpriority: "warning"
    icon: "https://raw.githubusercontent.com/falcosecurity/falco/master/logo.png"

  # Pushover output for critical alerts (will be configured via secret)
  pushover:
    userkey: ""
    apitoken: ""
    minimumpriority: "critical"

  # Prometheus metrics
  prometheus:
    extralabels: ""

  # Custom fields
  customfields: "cluster:homelab,environment:production"

  # Redis output - use Dragonfly for event storage
  redis:
    address: "dragonfly.database.svc.cluster.local:6379"
    # password is set via REDIS_PASSWORD environment variable from secret
    database: 1
    storagetype: "list"
    key: "falco"
    minimumpriority: "debug"

# Service
service:
  type: ClusterIP
  port: 2801

# Service Monitor for Prometheus
serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s

# Web UI - Enabled with external Dragonfly
webui:
  enabled: true
  replicaCount: 1

  # Use external Dragonfly - URL format required
  externalRedis:
    enabled: true
    url: "redis://dragonfly.database.svc.cluster.local:6379/1"

  # Disable bundled Redis
  redis:
    enabled: false

  # Resources
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      memory: 128Mi

# Pod Security
podSecurityContext:
  runAsUser: 1234
  runAsNonRoot: true
  fsGroup: 1234

securityContext:
  runAsUser: 1234
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Environment variables from secret
envFrom:
  - secretRef:
      name: falcosidekick-secret

