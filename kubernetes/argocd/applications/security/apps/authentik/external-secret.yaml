---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: authentik-secret
  namespace: security
spec:
  refreshInterval: 1h
  target:
    name: authentik-secret
    creationPolicy: Owner
    deletionPolicy: Retain
  data:
    # Authentik DBs
    - secretKey: AUTHENTIK_POSTGRESQL__HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 2e0decee-98ad-49a5-93dc-d666c526c93f
        property: init_postgres_host
    - secretKey: AUTHENTIK_POSTGRESQL__NAME
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: username
    - secretKey: AUTHENTIK_POSTGRESQL__USER
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: username
    - secretKey: AUTHENTIK_POSTGRESQL__PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: password
    - secretKey: AUTHENTIK_REDIS__PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: 96b09f19-7456-4713-bc67-be798b3ddc23
        property: password
    - secretKey: AUTHENTIK_REDIS__DB
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: redis_db
    - secretKey: AUTHENTIK_SECRET_KEY
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: secret_key
    # Authentik SMTP
    - secretKey: AUTHENTIK_EMAIL__HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: email_host
    - secretKey: AUTHENTIK_EMAIL__PORT
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: email_port
    - secretKey: AUTHENTIK_EMAIL__USERNAME
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: email_user
    - secretKey: AUTHENTIK_EMAIL__PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: email_pass
    - secretKey: AUTHENTIK_EMAIL__USE_SSL
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: email_use_ssl
    - secretKey: AUTHENTIK_EMAIL__FROM
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: email_from
    # Authentik Init DB
    - secretKey: INIT_POSTGRES_DBNAME
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: e1cb5198-96dd-442a-b2d1-a24251109f0f
        property: username
    - secretKey: INIT_POSTGRES_HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: 2e0decee-98ad-49a5-93dc-d666c526c93f
        property: init_postgres_host
    - secretKey: INIT_POSTGRES_USER
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: username
    - secretKey: INIT_POSTGRES_PASS
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: password
    - secretKey: INIT_POSTGRES_SUPER_USER
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: 2e0decee-98ad-49a5-93dc-d666c526c93f
        property: username
    - secretKey: INIT_POSTGRES_SUPER_PASS
      sourceRef:
        storeRef:
          name: bitwarden-login
          kind: ClusterSecretStore
      remoteRef:
        key: 2e0decee-98ad-49a5-93dc-d666c526c93f
        property: password
    # Homepage
    #- secretKey: HOMEPAGE_VAR_AUTHENTIK_TOKEN
    #  sourceRef:
    #    storeRef:
    #      name: bitwarden-fields
    #      kind: ClusterSecretStore
    #  remoteRef:
    #    key: e9152089-b309-403e-847d-88580eb573b8
    #    property: homepage_token
