---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: authentik-secret
  namespace: security
spec:
  refreshInterval: 1h
  target:
    name: authentik-secret
    creationPolicy: Owner
    deletionPolicy: Retain
  data:
    # Authentik DBs
    - secretKey: AUTHENTIK_POSTGRESQL__HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_host
    - secretKey: AUTHENTIK_POSTGRESQL__NAME
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_name
    - secretKey: AUTHENTIK_POSTGRESQL__USER
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_user
    - secretKey: AUTHENTIK_POSTGRESQL__PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_pass
    - secretKey: AUTHENTIK_REDIS__PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: redis_pass
    - secretKey: AUTHENTIK_REDIS__DB
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: redis_db
    - secretKey: AUTHENTIK_SECRET_KEY
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: secret_key
    # Authentik SMTP
    - secretKey: AUTHENTIK_EMAIL__HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: email_host
    - secretKey: AUTHENTIK_EMAIL__PORT
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: email_port
    - secretKey: AUTHENTIK_EMAIL__USERNAME
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: email_user
    - secretKey: AUTHENTIK_EMAIL__PASSWORD
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: email_pass
    - secretKey: AUTHENTIK_EMAIL__USE_SSL
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: email_use_ssl
    - secretKey: AUTHENTIK_EMAIL__FROM
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: email_from
    # Authentik Init DB
    - secretKey: INIT_POSTGRES_DBNAME
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_name
    - secretKey: INIT_POSTGRES_HOST
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_host
    - secretKey: INIT_POSTGRES_USER
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_user
    - secretKey: INIT_POSTGRES_PASS
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_pass
    - secretKey: INIT_POSTGRES_SUPER_PASS
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: psql_superpass
    # Homepage
    - secretKey: HOMEPAGE_VAR_AUTHENTIK_TOKEN
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: e9152089-b309-403e-847d-88580eb573b8
        property: homepage_token
