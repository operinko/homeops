---
apiVersion: tuppr.home-operations.com/v1alpha1
kind: TalosUpgrade
metadata:
  name: talos
  namespace: system-upgrade
spec:
  talos:
    # renovate: datasource=github-releases depName=siderolabs/talos
    version: v1.11.5

  policy:
    debug: false
    force: false
    rebootMode: default
    placement: soft

  healthChecks:
    # Check all nodes are ready
    - apiVersion: v1
      kind: Node
      expr: status.conditions.exists(c, c.type == "Ready" && c.status == "True")
      timeout: 10m

    # Check all ArgoCD applications are healthy and synced
    - apiVersion: argoproj.io/v1alpha1
      kind: Application
      namespace: argocd
      expr: |
        status.health.status == "Healthy" &&
        status.sync.status == "Synced"
      timeout: 10m

  talosctl:
    image:
      repository: ghcr.io/siderolabs/talosctl
      tag: v1.11.5
      pullPolicy: IfNotPresent

