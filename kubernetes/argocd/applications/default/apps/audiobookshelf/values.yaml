---
# Helm values for audiobookshelf app-template deployment
controllers:
  audiobookshelf:
    pod:
      securityContext:
        runAsNonRoot: true
        runAsUser: 1001
        runAsGroup: 1001
        fsGroup: 1001
        fsGroupChangePolicy: OnRootMismatch
        seccompProfile: { type: RuntimeDefault }
    containers:
      app:
        image:
          repository: ghcr.io/advplyr/audiobookshelf
          tag: 2.31.0@sha256:e23adb24848d99d19cd1e251aee4e1e12ed4f5effc8ccb21754b062b6a06cf66
        env:
          TZ: "Europe/Helsinki"
          AUDIOBOOKSHELF_UID: 1001
          AUDIOBOOKSHELF_GID: 1001
          CONFIG_PATH: /config
          METADATA_PATH: /config/metadata
        probes:
          liveness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /healthcheck
                port: 80
              initialDelaySeconds: 0
              periodSeconds: 10
              timeoutSeconds: 1
              failureThreshold: 3
          readiness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /healthcheck
                port: 80
              initialDelaySeconds: 0
              periodSeconds: 10
              timeoutSeconds: 1
              failureThreshold: 3
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities: { drop: ["ALL"] }
        resources:
          requests:
            cpu: 50m
            memory: 100Mi
          limits:
            memory: 500Mi
service:
  app:
    primary: true
    controller: audiobookshelf
    ports:
      http:
        port: 80
persistence:
  config:
    existingClaim: audiobookshelf
  cache:
    type: emptyDir
    globalMounts:
      - path: /.npm
  media:
    type: nfs
    server: 192.168.0.221
    path: /mnt/Nakkiallas/Media
    globalMounts:
      - path: /media
  tmpfs:
    type: emptyDir
    globalMounts:
      - path: /tmp
