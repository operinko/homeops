controllers:
  vaultwarden:
    annotations:
      reloader.stakater.com/auto: "true"
    initContainers:
      init-db:
        image:
          repository: ghcr.io/home-operations/postgres-init
          tag: 18.2
        envFrom:
          - secretRef:
              name: vaultwarden-secret
    pod:
      dnsConfig:
        options:
          - name: ndots
            value: "1"
    containers:
      app:
        image:
          repository: vaultwarden/server
          tag: 1.35.3@sha256:1ca2e2098ba9ab9e46004f4ee61a3be6080ffee3ed41018a95c4b0fb6454a54b
        env:
          DATA_FOLDER: "config"
          ICON_CACHE_FOLDER: "data/icon_cache"
          ATTACHMENTS_FOLDER: "data/attachments"
          DOMAIN: https://vaultwarden.vaderrp.com
          SIGNUPS_ALLOWED: "false"
          SMTP_FROM_NAME: Vaultwarden
          SMTP_PORT: 587
          SMTP_SSL: "true"
          SMTP_EXPLICIT_TLS: "true"
          TZ: Europe/Helsinki
          # Note: WEBSOCKET_ENABLED, WEBSOCKET_PORT, WEBSOCKET_ADDRESS
          # are no longer needed since v1.29.0 - websockets unified on main port
        envFrom:
          - secretRef:
              name: vaultwarden-secret
        resources:
          requests:
            cpu: 100m
            memory: 100Mi
          limits:
            memory: 2Gi
service:
  app:
    controller: vaultwarden
    ports:
      http:
        port: 80
      # websocket port 3012 removed - unified on main port since v1.29
ingress:
  app:
    enabled: false
persistence:
  config:
    existingClaim: vaultwarden
    globalMounts:
      - path: /config
