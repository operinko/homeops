---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: atuin
  namespace: default
spec:
  sourcePVC: atuin
  trigger:
    schedule: "0 */6 * * *"
  restic:
    repository: atuin-restic-secret
    retain:
      hourly: 24
      daily: 7
      weekly: 4
      monthly: 6
    copyMethod: Snapshot
    pruneIntervalDays: 7
    volumeSnapshotClassName: csi-mayastor-snapshotclass
---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationDestination
metadata:
  name: atuin-dst
  namespace: default
spec:
  trigger:
    manual: restore-once
  restic:
    repository: atuin-restic-secret
    copyMethod: Snapshot
    volumeSnapshotClassName: csi-mayastor-snapshotclass
    storageClassName: mayastor-volsync
    accessModes: ["ReadWriteOnce"]
    capacity: 1Gi
---
apiVersion: v1
kind: Secret
metadata:
  name: atuin-restic-secret
  namespace: default
stringData:
  RESTIC_REPOSITORY: rest:http://restic-repository-server.volsync.svc.cluster.local:8000/atuin
  RESTIC_PASSWORD: ${VOLSYNC_RESTIC_PASSWORD}
  AWS_ACCESS_KEY_ID: ${VOLSYNC_AWS_ACCESS_KEY_ID}
  AWS_SECRET_ACCESS_KEY: ${VOLSYNC_AWS_SECRET_ACCESS_KEY}
