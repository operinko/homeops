---
# ExternalSecret to create the gpro-github-pat secret used by the ResourceSetInputProvider
# Reuses the existing GHCR credentials Bitwarden entry which contains github_package_read_pat
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: gpro-github-pat
  namespace: flux-system
spec:
  refreshInterval: 1h
  target:
    name: gpro-github-pat
    creationPolicy: Owner
    deletionPolicy: Retain
    template:
      engineVersion: v2
      data:
        username: "{{ .docker_username }}"
        password: "{{ .github_package_read_pat }}"
  data:
    - secretKey: docker_username
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: f7f2ed36-37d2-438c-86b9-4e0d99c4b763
        property: docker_username
    - secretKey: github_package_read_pat
      sourceRef:
        storeRef:
          name: bitwarden-fields
          kind: ClusterSecretStore
      remoteRef:
        key: f7f2ed36-37d2-438c-86b9-4e0d99c4b763
        property: github_package_read_pat
