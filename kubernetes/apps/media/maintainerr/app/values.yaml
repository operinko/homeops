---
# Helm values for maintainerr app-template deployment
controllers:
  maintainerr:
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      app:
        image:
          repository: ghcr.io/maintainerr/maintainerr
          tag: 2.27.0
        env:
          TZ: Europe/Helsinki
          UI_PORT: &port 80
        envFrom:
          - secretRef:
              name: maintainerr-secret
        probes:
          liveness: &probes
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /api/app/status
                port: *port
              initialDelaySeconds: 30
              periodSeconds: 10
              timeoutSeconds: 5
              failureThreshold: 3
          readiness: *probes
        securityContext:
          allowPrivilegeEscalation: false
          # readOnlyRootFilesystem disabled: Maintainerr's Next.js build requires write access
          # to replace __PATH_PREFIX__ placeholders on startup. May be re-enabled after migration
          # to Vite + React Router. See: https://github.com/Maintainerr/Maintainerr/issues/2104 & https://github.com/Maintainerr/Maintainerr/pull/2100
          readOnlyRootFilesystem: false
          capabilities: { drop: ["ALL"] }
        resources:
          requests:
            cpu: 50m
            memory: 256Mi
          limits:
            memory: 512Mi
defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 568
    runAsGroup: 568
    fsGroup: 568
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }
  dnsConfig:
    options:
      - name: ndots
        value: "1"
      - name: use-vc
      - name: single-request-reopen
service:
  app:
    controller: maintainerr
    ports:
      http:
        port: *port
persistence:
  config:
    existingClaim: maintainerr
    globalMounts:
      - path: /opt/data
  tmp:
    type: emptyDir
