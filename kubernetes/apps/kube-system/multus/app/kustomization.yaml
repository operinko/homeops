---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ocirepository.yaml
  - helmrelease.yaml

patches:
  - patch: |
      apiVersion: apps/v1
      kind: DaemonSet
      metadata:
        name: multus
        namespace: kube-system
      spec:
        template:
          spec:
            initContainers:
              - name: install-cni
                image: ghcr.io/siderolabs/install-cni:v1.9.0
                command: ["/install-cni.sh"]
                securityContext:
                  privileged: true
                volumeMounts:
                  - mountPath: /host/opt/cni/bin
                    mountPropagation: Bidirectional
                    name: opt-cni-bin
    target:
      kind: DaemonSet
      name: multus
