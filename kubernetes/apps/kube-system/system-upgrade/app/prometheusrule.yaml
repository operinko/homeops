---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: system-upgrade-alerts
  namespace: system-upgrade
  labels:
    release: kube-prometheus-stack
spec:
  groups:
    - name: system-upgrade
      rules:
        - alert: SUCPlanFailedJobs
          expr: sum by (plan) (kube_job_failed{namespace="system-upgrade"}) > 0
          for: 2m
          labels:
            severity: critical
          annotations:
            summary: System Upgrade Plan {{ $labels.plan }} has failed Jobs
            description: One or more SUC Jobs failed for Plan {{ $labels.plan }}. Investigate with `kubectl -n system-upgrade describe plan {{ $labels.plan }}` and Job logs.
        - alert: SUCPlanStuck
          expr: sum by (plan) (kube_job_status_active{namespace="system-upgrade"}) > 0 and on(plan) sum by (plan) (time() - kube_job_status_start_time_seconds{namespace="system-upgrade"}) > 3600
          for: 15m
          labels:
            severity: warning
          annotations:
            summary: System Upgrade Plan {{ $labels.plan }} appears stuck (>1h active)
            description: A SUC Job has been active for more than an hour for Plan {{ $labels.plan }}. Check Pod logs and node condition.

