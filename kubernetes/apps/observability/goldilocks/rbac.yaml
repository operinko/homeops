---
# Additional RBAC for Goldilocks controller to read VolSync resources
# Goldilocks needs to read parent controllers of pods to generate VPA recommendations
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: goldilocks-volsync-reader
rules:
  # Read VolSync resources to determine pod ownership
  - apiGroups: ["volsync.backube"]
    resources:
      - replicationsources
      - replicationdestinations
    verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: goldilocks-volsync-reader
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: goldilocks-volsync-reader
subjects:
  - kind: ServiceAccount
    name: goldilocks-controller
    namespace: observability

