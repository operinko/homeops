---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/monitoring.coreos.com/alertmanagerconfig_v1alpha1.json
apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: alertmanager-receivers
  namespace: observability
  labels:
    release: kube-prometheus-stack
spec:
  route:
    groupBy: ['alertname','namespace']
    groupWait: 30s
    groupInterval: 5m
    repeatInterval: 4h
    receiver: pushover
    routes:
      - matchers:
          - name: alertname
            value: Watchdog
            matchType: '='
        receiver: 'null'
      - receiver: pushover
        continue: true
      - receiver: discord
  receivers:
    - name: 'null'
    - name: pushover
      pushoverConfigs:
        - token:
            name: alertmanager-pushover
            key: pushover_token
          userKey:
            name: alertmanager-pushover
            key: pushover_user
          title: '{{ .CommonAnnotations.summary | default .CommonLabels.alertname }}'
          message: '{{ .CommonAnnotations.description | default .CommonAnnotations.summary | default (printf "Alert %s in %s" .CommonLabels.alertname (.CommonLabels.namespace | default "unknown")) }}'
    - name: discord
      discordConfigs:
        - apiURL:
            name: alertmanager-discord
            key: webhook
          sendResolved: true
          title: '{{ .CommonAnnotations.summary | default .CommonLabels.alertname }}'
          message: '{{ .CommonAnnotations.description | default .CommonAnnotations.summary | default (printf "Alert %s in %s" .CommonLabels.alertname (.CommonLabels.namespace | default "unknown")) }}'

