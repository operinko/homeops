controllers:
  dragonfly-operator:
    strategy: RollingUpdate
    serviceAccount:
      name: dragonfly-operator
    containers:
      app:
        image:
          repository: ghcr.io/dragonflydb/operator
          tag: v1.4.0
        command: ["/manager"]
        args:
          - --health-probe-bind-address=:8081
          - --metrics-bind-address=:8080
        probes:
          liveness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /healthz
                port: &port 8081
              initialDelaySeconds: 30
              periodSeconds: 20
              timeoutSeconds: 5
              failureThreshold: 3
          readiness:
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /readyz
                port: *port
              initialDelaySeconds: 10
              periodSeconds: 10
              timeoutSeconds: 5
              failureThreshold: 3
        resources:
          requests:
            cpu: 10m
          limits:
            memory: 128Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities: { drop: ["ALL"] }
defaultPodOptions:
  securityContext:
    runAsNonRoot: true
    runAsUser: 65534
    runAsGroup: 65534
    seccompProfile: { type: RuntimeDefault }
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/name: dragonfly-operator
service:
  app:
    type: LoadBalancer
    annotations:
      lbipam.cilium.io/ips: "192.168.7.21"
    controller: dragonfly-operator
    ports:
      http:
        port: *port
      metrics:
        port: 8080
serviceMonitor:
  app:
    serviceName: dragonfly-operator
    endpoints:
      - port: metrics
        scheme: http
        path: /metrics
        interval: 1m
        scrapeTimeout: 10s
