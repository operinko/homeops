---
# Note: This is a special case for PostgreSQL. You'll need to ensure the database
# is properly prepared for backup (e.g., using pg_dump) before the snapshot is taken.
# Consider using CloudNative PG's built-in backup mechanisms instead or in addition to this.
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: postgres-backup
  namespace: database
spec:
  # This targets the PVC that CloudNative PG creates
  # The format is typically: <cluster-name>-<instance-number>
  # You may need to adjust this based on your actual PVC name
  sourcePVC: postgres-1
  trigger:
    schedule: "0 2 * * *" # Daily at 2 AM
  restic:
    # This references the secret containing the repository configuration
    repository: nfs-destination
    copyMethod: Snapshot
    volumeSnapshotClassName: csi-mayastor-snapshotclass
    storageClassName: mayastor-3-replicas
    # Note: Hooks are not supported in this version of VolSync
    # Consider using CloudNative PG's built-in backup mechanisms instead
